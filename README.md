# GoUnity

[![GitHub release](https://img.shields.io/github/release/Murray-LIANG/gounity.svg)](https://github.com/Murray-LIANG/gounity/releases)
[![Travis branch](https://travis-ci.com/Murray-LIANG/gounity.svg?branch=master)](https://travis-ci.org/Murray-LIANG/gounity/branches)
[![Coveralls github branch](https://img.shields.io/coveralls/github/Murray-LIANG/gounity/master.svg)](https://coveralls.io/github/Murray-LIANG/gounity)
[![Go Report Card](https://goreportcard.com/badge/github.com/Murray-LIANG/gounity)](https://goreportcard.com/report/github.com/Murray-LIANG/gounity)
[![license](https://img.shields.io/github/license/Murray-LIANG/gounity.svg)](https://github.com/Murray-LIANG/gounity/blob/develop/LICENSE)


GoUnity is a Go project that provides a client for managing Dell EMC Unity storage.


## Current State

**Under development. Please contribute and follow the [guideline](#contribute-guideline).**


## License

[Apache License version 2](LICENSE)


## Support Operations

- Query instances of:
  - Storage Pool
  - LUN
  - Snapshot
  - Host
  - Filesystem
  - Nas Server
  - NFS Share
  - Job
- Create/Delete LUNs
- Create/Delete Filesystems
- Create/Delete NFS Shares
- Attach/Detach Hosts to LUNs
- Create/Attach/Detach/Copy Snapshots
- Create/Cancel/Delete Jobs


## Installation

```bash
go get github.com/murray-liang/gounity
```


## Tutorial

### Create a connection to Unity Systems

```go
unity, err := gounity.NewUnity(
    "UnityMgmtIP", "username", "password", true,
)
if err != nil {
    panic(err)
}
```

### Query storage pools

```go
// List all the pools
pools, err := unity.GetPools()

// Get the pool by ID
pool, err := unity.GetPoolById("Pool_1")
```

### Create LUNs
```go
// Create a 3GB LUN named `lunName` on `pool`
lun, err := pool.CreateLun("lunName", 3)
```

### Query Hosts
```go
host, err := unity.GetHostById("Host_1")
```

### Attach LUNs to Hosts
```go
hluNum, err := host.Attach(lun)
```

### More examples
*_test.go files of this package contains lots of detailed examples.


## Optional Parameters
Optional parameters are supported for forward compatibility.

```go
fs, err := pool.CreateFilesystem(
    nas, "fs-name", 3,
    // `SupportedProtocol` is optional.
    gounity.SupportedProtocolsOpt(gounity.FSSupportedProtocolNFS),
)
```


## Triage

HTTP requests and responses are traced with logs by enabling `GOUNITY_TRACEHTTP`.
1. Set environment variable `GOUNITY_TRACEHTTP`.
    ```bash
    $ export GOUNITY_TRACEHTTP=true
    ```
2. In your codes, enable `Debug` log level of `logrus`.
    ```go
    logrus.SetLevel(logrus.DebugLevel)
    // Your codes continue here ......
    ```


## Issues

If you have any questions or find any issues, please post [Github Issues](https://github.com/murray-LIANG/gounity/issues).


## Contribute Guideline

### You are one of the collaborators
1. Create a branch from the latest `develop` branch: `git checkout -b <branch_name>`.
2. Push code changes to your branch. Please make sure your changes be covered by unittest.
3. Push your branch to the remote.
4. Publish a pull request from your branch to `develop` branch.
5. Merge the pull request after passing the review. Recommend using `Squash and Merge` and deleting your branch after merging.

### You aren't
1. Fork this repo as your own one.
2. Push code changes to your repo. Please make sure your changes be covered by unittest.
3. Publish a pull request from your repo to `develop` branch of this repo.
4. Wait for merging the pull request.

## Develop Tips

### Code Generation
`*_gen.go` source files are generated by `go generate`. The templates and source files can be found under `cmd/modelgen`. You are not supposed to edit the `*_gen.go` files but the templates.

Once you modify the templates, run `go generate`, then all `*_gen.go` files update.

### End to End Tests
Test cases in `integration_test.go` require a real Unity. `go test` won't run the cases there.

The below commands would help out.

```bash
# The integration tests would fail depending on the resources on Unity.
# Modify the cases accordingly before running.

# Command to test `CreateLun` on a real Unity.
$ go test -tags=integration -v -run TestE2ECreateLun \
    -args -mgmtIp='10.245.101.39' -username=admin -password=*****

# Command to run all integration tests on a real Unity.
$ go test -tags=integration -v \
    -args -mgmtIp='10.245.101.39' -username=admin -password=*****
```
